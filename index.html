<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>わたげ成長記録</title>
<style>
body {
    font-family: sans-serif;
}

/* モーダル全体 */
.modal {
    position: fixed;
    top: 0; left: 0; right: 0; bottom: 0;
    background: rgba(0,0,0,0.5);
    display: none;
    justify-content: center;
    align-items: center;
    z-index: 1000;
}

/* モーダルカード */
.modal-card {
    background: #fff;
    border-radius: 12px;
    width: 90%;
    max-width: 900px;
    max-height: 90vh;
    display: flex;
    overflow: hidden;
}

/* 写真カラム */
.modal-left {
    flex: 1;
    background: #f8f8f8;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    min-width: 300px;
}
.modal-left.hidden {
    display: none;
}
.modal-photo-placeholder {
    color: #aaa;
    font-size: 14px;
    text-align: center;
}

/* 右カラム */
.modal-right {
    flex: 1;
    padding: 16px;
    overflow-y: auto;
}

/* サムネイル */
.modal-thumbnails {
    display: flex;
    gap: 4px;
    overflow-x: auto;
    margin-top: 8px;
}
.modal-thumbnails img {
    width: 60px;
    height: 60px;
    object-fit: cover;
    cursor: pointer;
}

/* スマホ用 */
@media (max-width: 600px) {
    .modal-card {
        flex-direction: column;
        width: 100%;
        height: 100%;
        max-width: 100%;
        border-radius: 0;
        overflow-y: auto;
    }
    .modal-left, .modal-right {
        min-width: 100%;
        max-width: 100%;
    }
    .modal-thumbnails {
        height: auto;
        flex-direction: row;
        overflow-x: auto;
        overflow-y: hidden;
    }
    .model-thumbnalis img{
        flex:  0 0 auto;
    }
}
</style>
</head>
<body>

<!-- モーダル -->
<div id="dayModal" class="modal">
    <div class="modal-card">
        <div id="modalLeft" class="modal-left">
            <div id="modalMainPhotoWrapper">
                <span class="modal-photo-placeholder">📷 写真はまだありません</span>
            </div>
            <div id="modalThumbnails" class="modal-thumbnails"></div>
        </div>
        <div class="modal-right">
            <h2 id="modalDate"></h2>
            <input type="file" id="modalPhotoInput"><br>
            <input type="text" id="modalEventInput" placeholder="イベント名">
            <button id="modalAddEventBtn">イベント追加</button>
            <textarea id="modalDiary" placeholder="日記を書く…"></textarea><br>
            <input type="number" id="modalWeight" placeholder="体重(kg)">
            <div id="modalEntries"></div>
            <button id="modalCloseBtn">閉じる</button>
        </div>
    </div>
</div>

<script>
const modal = document.getElementById('dayModal');
const modalLeft = document.getElementById('modalLeft');
const modalMainPhotoWrapper = document.getElementById('modalMainPhotoWrapper');
const modalThumbnails = document.getElementById('modalThumbnails');
const modalDate = document.getElementById('modalDate');
const modalCloseBtn = document.getElementById('modalCloseBtn');

let currentDayData = {
    photos: []
};

// モーダルを開く（テスト用）
function openModal(date, data) {
    currentDayData = data || { photos: [] };
    modalDate.textContent = date;
    
    // 写真がない場合 → 左カラム非表示
    if (!currentDayData.photos || currentDayData.photos.length === 0) {
        modalLeft.classList.add('hidden');
    } else {
        modalLeft.classList.remove('hidden');
        renderPhotos();
    }
    
    modal.style.display = 'flex';
}

function renderPhotos() {
    modalThumbnails.innerHTML = '';
    if (currentDayData.photos.length > 0) {
        const latest = currentDayData.photos[currentDayData.photos.length - 1];
        const latestSrc = typeof latest === 'string' ? latest : latest.src;
        modalMainPhotoWrapper.innerHTML = `<img src="${latestSrc}" style="max-width:100%;max-height:400px;">`;
        currentDayData.photos.forEach(p => {
            const src = typeof p === 'string' ? p : p.src;
            const img = document.createElement('img');
            img.src = src;
            img.onclick = () => {
                modalMainPhotoWrapper.innerHTML = `<img src="${src}" style="max-width:100%;max-height:400px;">`;
            };
            modalThumbnails.appendChild(img);
        });
    }
}

// 閉じる
modalCloseBtn.onclick = () => {
    modal.style.display = 'none';
};

// テスト起動
document.addEventListener('DOMContentLoaded', () => {
    openModal('2025-08-01', { photos: [] }); // 空で表示
});
</script>

</body>
</html>
